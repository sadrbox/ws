# üìã –õ–æ–≥–∏–∫–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞–±–ª–∏—Ü—ã (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è)

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- ‚úÖ –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–æ–∫ –ø–æ **200 —Å—Ç—Ä–æ–∫** (–±–∞–∑–æ–≤—ã–π –ª–∏–º–∏—Ç)
- ‚úÖ –ü–æ–¥–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–µ –Ω–∞ **>50 —Å—Ç—Ä–æ–∫** –æ—Ç –∫–æ–Ω—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Å–∫—Ä–æ–ª–∞ (>500 —Å—Ç—Ä–æ–∫) - –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –ø–æ **1000 —Å—Ç—Ä–æ–∫**

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

### 1Ô∏è‚É£ **–ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** (ActivityHistories)

```typescript
const [adaptiveLimit, setAdaptiveLimit] = useState<number>(200);
// –ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = 200 —Å—Ç—Ä–æ–∫
```

### 2Ô∏è‚É£ **–¢—Ä–∏–≥–≥–µ—Ä –ø–æ–¥–≥—Ä—É–∑–∫–∏** (Table/checkAndFetch)

```
–£—Å–ª–æ–≤–∏–µ –ø–æ–¥–≥—Ä—É–∑–∫–∏:
  currentViewEnd >= loadedRowsCount - FETCH_BUFFER

–ì–¥–µ:
  currentViewEnd = –≤–∏–¥–∏–º–∞—è –≤ viewport –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞
  loadedRowsCount = –≤—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—Ä–æ–∫
  FETCH_BUFFER = 50 —Å—Ç—Ä–æ–∫ (—Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –∫–æ–Ω—Ü—É)

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –ï–©–ï —Ä—è–¥ —Å—Ç—Ä–æ–∫ –∫–æ–≥–¥–∞ –ø—Ä–∏–±–ª–∏–∂–∞–µ–º—Å—è –∫ –∫–æ–Ω—Ü—É
```

### 3Ô∏è‚É£ **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞** (Table/checkAndFetch)

```
scrollDistanceInRows = Math.floor(scrollTop / ROW_HEIGHT)

–ï—Å–ª–∏ scrollDistanceInRows > 500:
  ‚îú‚îÄ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–∞
  ‚îî‚îÄ limit = 1000 —Å—Ç—Ä–æ–∫ (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–º —Å–∫—Ä–æ–ª–µ)

–ò–Ω–∞—á–µ:
  ‚îú‚îÄ –ú–∞–ª–æ–µ –∏–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
  ‚îî‚îÄ limit = 200 —Å—Ç—Ä–æ–∫ (–±–∞–∑–æ–≤—ã–π)
```

### 4Ô∏è‚É£ **–ü–µ—Ä–µ–¥–∞—á–∞ –ª–∏–º–∏—Ç–∞ –≤ API** (useInfiniteModelList)

```
1. –õ–∏–º–∏—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ GLOBAL_ADAPTIVE_LIMIT_REF.current
2. queryFn —á–∏—Ç–∞–µ—Ç: GLOBAL_ADAPTIVE_LIMIT_REF.current
3. –î–æ–±–∞–≤–ª—è–µ—Ç –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä: query.limit = limit
4. API –ø–æ–ª—É—á–∞–µ—Ç: &limit=200 –∏–ª–∏ &limit=1000
```

## üìà –ü—Ä–∏–º–µ—Ä—ã:

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

```
1. –¢–∞–±–ª–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
2. adaptiveLimit = 200 (–Ω–∞—á–∞–ª—å–Ω–æ–µ)
3. API –∑–∞–ø—Ä–æ—Å: GET /api/activityhistories?limit=200
4. –ü–æ–ª—É—á–∞–µ–º 200 —Å—Ç—Ä–æ–∫
```

### –ü—Ä–∏–º–µ—Ä 2: –ú–∞–ª—ã–π —Å–∫—Ä–æ–ª—å (—Å–∫—Ä–æ–ª–ª–∏–º –Ω–µ–º–Ω–æ–≥–æ)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç, scrollDistanceInRows = 100
2. currentViewEnd –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ loadedRowsCount - 50
3. –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç: –ü–†–ò –°–ö–†–û–õ–ï >50 –°–¢–†–û–ö –û–¢ –ö–û–ù–¶–ê
4. scrollDistanceInRows = 100 ‚â§ 500
5. adaptiveLimit = 200
6. API –∑–∞–ø—Ä–æ—Å: GET /api/activityhistories?cursor=200&limit=200
```

### –ü—Ä–∏–º–µ—Ä 3: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª—å (—Å–∫—Ä–æ–ª–ª–∏–º —Å–∏–ª—å–Ω–æ –≤–Ω–∏–∑)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –¥–∞–ª–µ–∫–æ, scrollDistanceInRows = 800
2. currentViewEnd –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ loadedRowsCount - 50
3. –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
4. scrollDistanceInRows = 800 > 500
5. adaptiveLimit = 1000
6. API –∑–∞–ø—Ä–æ—Å: GET /api/activityhistories?cursor=1000&limit=1000
7. –ó–∞–≥—Ä—É–∂–∞–µ–º –±—ã—Å—Ç—Ä–æ 1000 —Å—Ç—Ä–æ–∫ –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–π —á–∞—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã
```

## üîÑ –û—á–µ—Ä–µ–¥—å –∑–∞–ø—Ä–æ—Å–æ–≤ (useRequestQueue)

```
–ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–æ–ª—å ‚Üí –º–Ω–æ–≥–æ fetchNextPage() –≤—ã–∑–æ–≤–æ–≤
  ‚Üì
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –û–ß–ï–†–ï–î–¨
  ‚Üì
–ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û
  ‚Üì
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∑–∞–≤–∏—Å–Ω–µ—Ç > 30 —Å–µ–∫ ‚Üí –æ—Ç–º–µ–Ω—è–µ–º –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
  ‚Üì
‚úÖ –ù–∏–∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–Ω—Å–æ–ª—å)

```
[Table.checkAndFetch] Normal scroll: 100 rows ‚â§ 500 ‚Üí limit=200
[Table.checkAndFetch] Significant scroll: 800 rows > 500 ‚Üí limit=1000
[RequestQueue] Adding request: activityhistories-page-200
[RequestQueue] Request activityhistories-page-200 completed
```

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞**: GET –∑–∞–ø—Ä–æ—Å —Å `limit=200` ‚úì
2. **–ú–∞–ª—ã–π —Å–∫—Ä–æ–ª—å**: –ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –∫–æ–Ω—Ü—É - –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å `limit=200` ‚úì
3. **–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª—å**: –ü—Ä–∏ —Å–∫—Ä–æ–ª–µ –≤–Ω–∏–∑ –Ω–∞ > 500 —Å—Ç—Ä–æ–∫ - –∑–∞–ø—Ä–æ—Å —Å `limit=1000` ‚úì
4. **–û—á–µ—Ä–µ–¥—å**: –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–æ–ª—å –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ‚úì
5. **–û—Ç–º–µ–Ω –Ω–µ—Ç**: –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ Network –∏–º–µ—é—Ç —Å—Ç–∞—Ç—É—Å 200 (–Ω–µ canceled) ‚úì

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π                  | –õ–∏–º–∏—Ç    | –≠—Ñ—Ñ–µ–∫—Ç                            |
| ------------------------- | -------- | --------------------------------- |
| –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞           | 200      | –ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ 200     |
| –°–∫—Ä–æ–ª—å –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑         | 200      | –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª—å –±–µ–∑ —Ä—ã–≤–∫–æ–≤         |
| –°–∫—Ä–æ–ª—å –¥–∞–ª–µ–∫–æ –≤–Ω–∏–∑ (>500) | 1000     | –ë—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–æ–ª—å—à–∏–µ –ø–æ—Ä—Ü–∏–∏ |
| –û—á–µ–Ω—å –±–æ–ª—å—à–æ–π –¥–∞—Ç–∞—Å–µ—Ç     | 200-1000 | –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –µ—Å–ª–∏ > 200   |
