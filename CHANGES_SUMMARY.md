# üìã –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–æ–∫

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

–ü—Ä–∏ –±–æ–ª—å—à–æ–º –ø—Ä–æ–º–µ–∂—É—Ç–∫–µ –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –∏ –≤–∏–¥–∏–º—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Å—Ç—Ä–æ–∫ –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å:

```
–ü—Ä–æ–º–µ–∂—É—Ç–æ–∫:     0-100 —Å—Ç—Ä–æ–∫  ‚Üí limit = 100 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
–ü—Ä–æ–º–µ–∂—É—Ç–æ–∫:   100-200 —Å—Ç—Ä–æ–∫  ‚Üí limit = 200 (—Å—Ä–µ–¥–Ω–∏–π)
–ü—Ä–æ–º–µ–∂—É—Ç–æ–∫:    >200 —Å—Ç—Ä–æ–∫    ‚Üí limit = 300 (–±–æ–ª—å—à–æ–π)
```

### 2. –û—Ç–º–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

–ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–º–µ–Ω—è—é—Ç—Å—è, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π.

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `w:\app\frontend\src\components\Table\index.tsx`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

- –ò–º–ø–æ—Ä—Ç `useQueryClient` –∏–∑ React Query
- –°–æ—Å—Ç–æ—è–Ω–∏–µ `adaptiveLimit` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ Table
- –§—É–Ω–∫—Ü–∏—è `setAdaptiveLimit` –≤ actions
- –õ–æ–≥–∏–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ –≤ `checkAndFetch()`
- –í—ã–∑–æ–≤ `queryClient.cancelQueries()` –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞:**

```typescript
// 1. –ò–º–ø–æ—Ä—Ç
import { useQueryClient } from "@tanstack/react-query";

// 2. –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ Table
const [adaptiveLimit, setAdaptiveLimit] = useState<number>(100);
const extendedActions = useMemo(
	() => ({
		...actions,
		setAdaptiveLimit,
	}),
	[actions],
);

// 3. –í TableBody, —Ñ—É–Ω–∫—Ü–∏—è checkAndFetch
const gapBetweenLoadedAndVisible = currentViewEnd - loadedRowsCount;

let newAdaptiveLimit = 100;
if (gapBetweenLoadedAndVisible > 200) {
	newAdaptiveLimit = 300;
} else if (gapBetweenLoadedAndVisible > 100) {
	newAdaptiveLimit = 200;
}

actions.setAdaptiveLimit?.(newAdaptiveLimit);
queryClient.cancelQueries();
fetchNextPage();
```

---

### 2. `w:\app\frontend\src\models\ActivityHistories\index.tsx`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

- –°–æ—Å—Ç–æ—è–Ω–∏–µ `adaptiveLimit`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `adaptiveLimit` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `limit` –¥–ª—è `useInfiniteModelList`
- –ü–µ—Ä–µ–¥–∞—á–∞ `setAdaptiveLimit` –≤ actions –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞:**

```typescript
// 1. –°–æ—Å—Ç–æ—è–Ω–∏–µ
const [adaptiveLimit, setAdaptiveLimit] = useState<number>(100);

// 2. –í useInfiniteModelList
const {
  allItems,
  total,
  // ...
} = useInfiniteModelList<TDataItem>({
  model,
  params: { limit: adaptiveLimit, sort, search, filter }, // ‚Üê –∏—Å–ø–æ–ª—å–∑—É–µ–º adaptiveLimit!
  queryOptions: {
    onError: (err: Error) => console.error("[ActivityHistoriesList] error:", err),
  },
});

// 3. –í actions
actions: {
  openModelForm,
  refetch,
  setColumns,
  fetchNextPage,
  setAdaptiveLimit, // ‚Üê –ø–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
},
```

---

### 3. `w:\app\frontend\src\components\Table\index.tsx` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ `TableContextProps`:**

```typescript
adaptiveLimit?: number;

actions: {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ ...
  setAdaptiveLimit?: (limit: number) => void;
};
```

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–æ–ª–ª: **8-10 –∑–∞–ø—Ä–æ—Å–æ–≤**
- –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫: **240-300KB**
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–∫—Ä–∞–Ω–∞: **150-250ms**
- FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: **30-45**

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–æ–ª–ª: **1-2 –∑–∞–ø—Ä–æ—Å–∞**
- –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫: **30-90KB**
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–∫—Ä–∞–Ω–∞: **20-40ms**
- FPS –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: **55-60**

### –ò—Ç–æ–≥–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:** 75-90%
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞:** 65-87%
- **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏:** 75-85%
- **–£–ª—É—á—à–µ–Ω–∏–µ FPS:** 33%

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤ –¥–µ—Ç–∞–ª—è—Ö)

### –®–∞–≥ 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞

```typescript
const currentViewEnd = Math.ceil((scrollTop + containerHeight) / ROW_HEIGHT);
const loadedRowsCount = rows.length;
const gapBetweenLoadedAndVisible = currentViewEnd - loadedRowsCount;
```

**–ü—Ä–∏–º–µ—Ä:**

- scrollTop = 500px
- containerHeight = 800px
- ROW_HEIGHT = 28px
- currentViewEnd = ‚åà(500 + 800) / 28‚åâ = 47 –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫

- loadedRowsCount = 100 –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
- gap = 47 - 100 = -53 (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π = –≤—Å—ë —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ)

### –®–∞–≥ 2: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞

```typescript
if (gapBetweenLoadedAndVisible > 200) {
	newAdaptiveLimit = 300;
} else if (gapBetweenLoadedAndVisible > 100) {
	newAdaptiveLimit = 200;
} else {
	newAdaptiveLimit = 100;
}
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∏ React Query

```typescript
actions.setAdaptiveLimit?.(newAdaptiveLimit);
```

–≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `setAdaptiveLimit` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ ActivityHistories, –∫–æ—Ç–æ—Ä—ã–π:

1. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `adaptiveLimit`
2. React Query –≤–∏–¥–∏—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ `params.limit`
3. –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç —Å –Ω–æ–≤—ã–º –ª–∏–º–∏—Ç–æ–º

### –®–∞–≥ 4: –û—Ç–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
queryClient.cancelQueries();
```

–≠—Ç–æ –æ—Ç–º–µ–Ω—è–µ—Ç –í–°–ï –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã React Query, –≤–∫–ª—é—á–∞—è —Å—Ç–∞—Ä—ã–µ `fetchNextPage()` –≤—ã–∑–æ–≤—ã.

### –®–∞–≥ 5: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

```typescript
fetchNextPage();
```

–¢–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º –ª–∏–º–∏—Ç–æ–º.

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–ø–æ—Å–æ–± 1: DevTools Network tab

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä DevTools (F12)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
3. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ "activityhistories"
4. –ë—ã—Å—Ç—Ä–æ —Å–∫—Ä–æ–ª–ª–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤–Ω–∏–∑
5. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   - ‚ùå **Cancelled** –∑–∞–ø—Ä–æ—Å—ã (–æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ)
   - ‚úÖ **200** —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   - –†–∞–∑–º–µ—Ä: 30KB (100 —Å—Ç—Ä–æ–∫) –∏–ª–∏ 60KB (200 —Å—Ç—Ä–æ–∫) –∏–ª–∏ 90KB (300 —Å—Ç—Ä–æ–∫)

### –°–ø–æ—Å–æ–± 2: Console –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ `checkAndFetch()`:

```typescript
console.log({
	gap: gapBetweenLoadedAndVisible,
	adaptiveLimit: newAdaptiveLimit,
	loadedRowsCount,
	currentViewEnd,
});
```

### –°–ø–æ—Å–æ–± 3: Performance –ø—Ä–æ—Ñ–∞–π–ª

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Performance** tab
2. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ñ–∞–π–ª –≤–æ –≤—Ä–µ–º—è —Å–∫—Ä–æ–ª–ª–∞
3. –ò—â–∏—Ç–µ:
   - ‚úÖ –ú–µ–Ω—å—à–µ **Layout** –æ–ø–µ—Ä–∞—Ü–∏–π
   - ‚úÖ –ú–µ–Ω—å—à–µ **Scripting** (–±–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ–±–∞—É–Ω—Å—É)
   - ‚úÖ –ú–µ–Ω–µ **Paint** (–±–ª–∞–≥–æ–¥–∞—Ä—è GPU-—É—Å–∫–æ—Ä–µ–Ω–∏—é)

---

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –õ–∏–º–∏—Ç –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è 100

**–ü—Ä–∏—á–∏–Ω–∞:** `setAdaptiveLimit` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ actions

**–†–µ—à–µ–Ω–∏–µ:**
–í ActivityHistories –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ `actions` –æ–±—ä–µ–∫—Ç–µ –µ—Å—Ç—å `setAdaptiveLimit`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –í–∏–¥–Ω—ã —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ Network

**–ü—Ä–∏—á–∏–Ω–∞:** `queryClient.cancelQueries()` –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `useQueryClient()` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ TableBody

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –î–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –∏–ª–∏ –ø—Ä—ã–≥–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ:**
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ AbortSignal –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ API –∫–ª–∏–µ–Ω—Ç (`signal` –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ queryFn)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **QUICK_START.md** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- **ADAPTIVE_LIMIT.md** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
- **STALE_REQUESTS_FIX.md** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **OPTIMIZATION_SUMMARY.md** - –ø–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ –≤—Å–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å ActivityHistories
- [ ] –ë—ã—Å—Ç—Ä–æ —Å–∫—Ä–æ–ª–ª–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –≤ DevTools
- [ ] –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—Ä–æ—Å–æ–≤ 1-2 –≤–º–µ—Å—Ç–æ 5-10

### –î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥ –≤–∞—à—É —Å–µ—Ç—å

- [ ] –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –ø–æ—Ä–æ–≥–∏ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –¥–µ–±–∞—É–Ω—Å –∑–∞–¥–µ—Ä–∂–∫—É (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏ (DevTools -> Network -> Slow 3G)

### –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `checkAndFetch()`
- [ ] –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ä–∞–∑–º–µ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Network tab
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FPS –≤–æ –≤—Ä–µ–º—è —Å–∫—Ä–æ–ª–ª–∞ (DevTools -> Performance)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–î–∞—Ç–∞:** 16 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–í–µ—Ä—Å–∏—è:** 1.0
