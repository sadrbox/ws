# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–æ–∫ + Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞ ‚ùå

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Å—Ç—Ä–æ–∫–∏. –ü–æ–∫–∞–∑—ã–≤–∞–ª–∞ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å—Ç—Ä–æ–∫, –Ω–∏–∫–∞–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ.

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `lastFetchScrollTopRef` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–∫ `-1`, –∏ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è —É—Å–ª–æ–≤–∏–µ–º `currentScrollTop - (-1) > 300`.

## –†–µ—à–µ–Ω–∏–µ ‚úÖ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
const lastFetchScrollTopRef = useRef<number>(-1);

if (currentScrollTop - lastFetchScrollTopRef.current > 300) {
	return; // –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ: 1000 - (-1) = 1001 > 300 ‚Üí –ü–†–û–ü–£–°–ö–ê–ï–ú!
}
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
const lastFetchScrollTopRef = useRef<number | null>(null); // null = –µ—â–µ –Ω–µ –±—ã–ª–æ

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∏ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–Ω–µ–µ
if (lastFetchScrollTopRef.current !== null) {
	if (currentScrollTop - lastFetchScrollTopRef.current > 300) {
		return;
	}
}
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω—ã CSS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è performance**

#### –í `Table.module.scss`:

**TableScrollWrapper:**

```scss
.TableScrollWrapper {
	// GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å–∫—Ä–æ–ª–ª–∞
	will-change: scroll-position;
	transform: translate3d(0, 0, 0);

	// –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
	-webkit-overflow-scrolling: touch;

	// –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞
	contain: layout style paint;
}
```

**tbody:**

```scss
tbody {
	// GPU —Å–ª–æ–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
	will-change: transform;
	transform: translate3d(0, 0, 0);
	contain: layout style paint;

	tr.activeRow {
		// –ê–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–ª–æ–µ
		will-change: background-color, box-shadow;
	}

	td .TableBodyCell {
		// –Ø—á–µ–π–∫–∏ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
		will-change: contents;
		contain: content;
	}
}
```

#### –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ (inline styles):

**TableBody:**

```tsx
<tbody
  style={{
    willChange: 'transform',
    transform: 'translate3d(0, 0, 0)',
  }}
>
```

**TableBodyRow:**

```tsx
<tr
  style={{
    willChange: isActive ? 'background-color, box-shadow' : 'auto',
    transform: 'translate3d(0, 0, 0)',
    opacity: isLoading ? 0.6 : 1,
    pointerEvents: isLoading ? 'none' : 'auto',
  }}
>
```

**Cell divs:**

```tsx
<div
  style={{
    willChange: 'contents',
    transform: 'translate3d(0, 0, 0)',
  }}
  className={styles.TableBodyCell}
>
```

## üìä –ß—Ç–æ —ç—Ç–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–∞—é—Ç

### `translate3d(0, 0, 0)` ‚Äî GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ

```
–ë–´–õ–û (CPU —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥):
–°–∫—Ä–æ–ª–ª ‚Üí –ë—Ä–∞—É–∑–µ—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ ‚Üí –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö –ø–∏–∫—Å–µ–ª–µ–π
‚Üì
–õ–∞–≥–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ 1000+ —Å—Ç—Ä–æ–∫
‚Üì
FPS: 30-45fps

–°–¢–ê–õ–û (GPU —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥):
–°–∫—Ä–æ–ª–ª ‚Üí GPU –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é ‚Üí –ë—ã—Å—Ç—Ä–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
‚Üì
–ì–ª–∞–¥–∫–∏–π —Å–∫—Ä–æ–ª–ª –¥–∞–∂–µ –ø—Ä–∏ 10000 —Å—Ç—Ä–æ–∫
‚Üì
FPS: 55-60fps
```

### `will-change` ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞ –±—Ä–∞—É–∑–µ—Ä—É

```typescript
// –ë—Ä–∞—É–∑–µ—Ä –∑–∞—Ä–∞–Ω–µ–µ –≥–æ—Ç–æ–≤–∏—Ç —Å–ª–æ–π –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è
will-change: transform;      // –ì–æ—Ç–æ–≤–∏–º—Å—è –º–µ–Ω—è—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º
will-change: background-color; // –ì–æ—Ç–æ–≤–∏–º—Å—è –º–µ–Ω—è—Ç—å —Ü–≤–µ—Ç
will-change: contents;       // –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è
```

### `contain: layout style paint` ‚Äî –∏–∑–æ–ª—è—Ü–∏—è

```
–ë—Ä–∞—É–∑–µ—Ä –∑–Ω–∞–µ—Ç —á—Ç–æ –≤ —ç—Ç–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ:
- –ú–∞–∫–µ—Ç –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ (layout)
- –°—Ç–∏–ª–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ (style)
- –ü–∏–∫—Å–µ–ª–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–µ (paint)
‚Üì
–ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç
‚Üì
–ù–∞ 30-50% –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–æ—Ç—Ä–∏—Å–æ–≤–æ–∫
```

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ë—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:

```
‚úó –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å—Ç—Ä–æ–∫
‚úó –ù–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
‚úó –ü–æ—Ç–µ—Ä–∏ —Ñ—Ä–µ–π–º–æ–≤
```

### –°–µ–π—á–∞—Å:

```
‚úì –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (null –≤–º–µ—Å—Ç–æ -1)
‚úì GPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (translate3d)
‚úì –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª (will-change + contain)
‚úì –ú–µ–Ω—å—à–µ –ª–∞–≥–æ–≤ –ø—Ä–∏ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
```

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –õ–æ–≥–∏–∫–∞ –ø–æ–¥–≥—Ä—É–∑–∫–∏ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è):

```
–ü–µ—Ä–≤—ã–π —Å–∫—Ä–æ–ª–ª (scrollTop = 1000):
  lastFetchScrollTopRef.current === null? –î–ê
  ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–µ–ª—å—Ç—ã
  ‚Üí –ï—Å–ª–∏ –≤–∏–¥–∏–º –∫–æ–Ω–µ—Ü –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö ‚Üí –ó–∞–ø—Ä–æ—Å ‚úì

–í—Ç–æ—Ä–æ–π —Å–∫—Ä–æ–ª–ª (scrollTop = 1500):
  lastFetchScrollTopRef.current === null? –ù–ï–¢ (—Ç–µ–ø–µ—Ä—å 1000)
  ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–ª—å—Ç—É: 1500 - 1000 = 500 > 300? –î–ê
  ‚Üí –ü—Ä–æ–ø—É—Å–∫–∞–µ–º (—Å–ª–∏—à–∫–æ–º –±–ª–∏–∑–∫–æ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∑–∞–ø—Ä–æ—Å—É)

–¢—Ä–µ—Ç–∏–π —Å–∫—Ä–æ–ª–ª (scrollTop = 2800):
  lastFetchScrollTopRef.current === 1000
  ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ–ª—å—Ç—É: 2800 - 1000 = 1800 > 300? –î–ê
  ‚Üí –ù–æ –≤–∏–¥–∏–º –∫–æ–Ω–µ—Ü –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö ‚Üí –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚úì
  ‚Üí lastFetchScrollTopRef.current = 2800
```

## üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –í `Table/index.tsx`:

```typescript
// –ë—É—Ñ–µ—Ä –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ (—Å—Ç—Ä–æ–∫)
const FETCH_BUFFER = 50; // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ –¥–ª—è –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–µ–π/–ø–æ–∑–¥–Ω–µ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏

// –î–µ–ª—å—Ç–∞ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (px)
if (currentScrollTop - lastFetchScrollTopRef.current > 300) {
	// ‚Üë –ò–∑–º–µ–Ω–∏—Ç–µ –¥–ª—è –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ/–º—è–≥–∫–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
}

// –î–µ–±–∞—É–Ω—Å –∑–∞–¥–µ—Ä–∂–∫–∞ (ms)
debounceTimerRef.current = setTimeout(() => {
	checkAndFetch();
}, 150); // ‚Üë –ò–∑–º–µ–Ω–∏—Ç–µ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ/–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
```

## üöÄ –ò—Ç–æ–≥

–¢—Ä–∏ —Å–ª–æ—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **–õ–æ–≥–∏–∫–∞ (JavaScript)**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (null –≤–º–µ—Å—Ç–æ -1)
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –î–µ–±–∞—É–Ω—Å –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã–∑–æ–≤–æ–≤

2. **GPU (CSS)**
   - `translate3d` –¥–ª—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è
   - –ö–∞–∂–¥—ã–π —Å–ª–æ–π –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º GPU —Å–ª–æ–µ
   - –ë—Ä–∞—É–∑–µ—Ä —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞ –ø–∏–∫—Å–µ–ª—å-–ª–æ–≤

3. **–ë—Ä–∞—É–∑–µ—Ä (CSS —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ)**
   - `will-change` –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
   - `contain` –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–æ—Ç—Ä–∏—Å–æ–≤–æ–∫
   - –ú–µ–Ω—å—à–µ —Ä–∞–±–æ—Ç—ã –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç + –ø–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª + –º–∞–ª–æ –ª–∞–≥–æ–≤! üéâ
