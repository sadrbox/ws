#!/bin/bash

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é (–ø–∞–ø–∫–µ, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç)
REPO_DIR="$(cd "$(dirname "$0")" && pwd)"
BRANCH="main"  # –£–∫–∞–∂–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É (–æ–±—ã—á–Ω–æ main –∏–ª–∏ master)
REMOTE="origin"

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
cd "$REPO_DIR" || { echo "–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–π—Ç–∏ –≤ $REPO_DIR"; exit 1; }

# –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
git fetch "$REMOTE"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ—Ç–ª–∏—á–∏—è –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ —É–¥–∞–ª—ë–Ω–Ω–æ–π –≤–µ—Ç–∫–æ–π
LOCAL=$(git rev-parse "$BRANCH")
REMOTE_LATEST=$(git rev-parse "$REMOTE/$BRANCH")

if [ "$LOCAL" = "$REMOTE_LATEST" ]; then
    echo "‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã. –û–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–µ—Ç."
elif git merge-base --is-ancestor "$LOCAL" "$REMOTE_LATEST"; then
    echo "üîÑ –í —É–¥–∞–ª—ë–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
    git pull --rebase "$REMOTE" "$BRANCH"
elif git merge-base --is-ancestor "$REMOTE_LATEST" "$LOCAL"; then
    echo "üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–æ–≤–µ–µ. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª—ë–Ω–Ω—ã–π..."
    git add .
    git commit -m "Auto commit: $(date +'%Y-%m-%d %H:%M:%S')"
    git push "$REMOTE" "$BRANCH"
else
    echo "‚ö†Ô∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∏ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ä–∞–∑–æ—à–ª–∏—Å—å. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ!"
    exit 1
fi
