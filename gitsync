#!/bin/bash
# 

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏
BRANCH="main"
REMOTE="origin"
USERNAME="sadrbox"
TOKEN="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"
REPO_URL="https://${USERNAME}:${TOKEN}@github.com/${USERNAME}/ws.git"

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
REPO_DIR="$(pwd)"
cd "$REPO_DIR" || { echo "‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–π—Ç–∏ –≤ $REPO_DIR"; exit 1; }

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."

# git pull —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω
git pull "$REPO_URL" "$BRANCH" || { echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ git pull"; exit 1; }

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git status -s

if [ -n "$(git status --porcelain)" ]; then
    echo "‚úèÔ∏è –ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫ –∫–æ–º–º–∏—Ç—É..."
    
    git add .

    commit_msg="Auto commit: $(date +'%Y-%m-%d %H:%M:%S')"
    git commit -m "$commit_msg" || { echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞"; exit 1; }

    echo "üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
    git push "$REPO_URL" "$BRANCH" || { echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ git push"; exit 1; }
else
    echo "‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞."
fi

git status -s
