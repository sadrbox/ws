# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ —Å–∫—Ä–æ–ª–±–∞—Ä–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å–∫—Ä–æ–ª–ª–∏–ª –º–∏–º–æ —ç—Ç–∏—Ö –ø–æ–∑–∏—Ü–∏–π. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:

- –ò–∑–ª–∏—à–Ω–µ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Å–µ—Ç—å
- –ü–æ–ª–æ—Å–µ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏—è –≤–ø—É—Å—Ç—É—é
- –í–æ–∑–º–æ–∂–Ω—ã–º —Å–µ—Ç–µ–≤—ã–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º

## –†–µ—à–µ–Ω–∏–µ

### –ü–æ–¥—Ö–æ–¥: –û—Ç–º–µ–Ω–∞ –≤—Å–µ—Ö –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –Ω–æ–≤–æ–º —Å–∫—Ä–æ–ª–ª–µ

**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:**
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ —Å–∫—Ä–æ–ª–ª–∏—Ç –∏ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è —É—Å–ª–æ–≤–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º—ã –æ—Ç–º–µ–Ω—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `queryClient.cancelQueries()` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –Ω–æ–≤–æ–≥–æ `fetchNextPage()`.

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ:

1. ‚úÖ –¢–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å** –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω
2. ‚úÖ –í—Å–µ **–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –±—É–¥—É—Ç –æ—Ç–º–µ–Ω–µ–Ω—ã
3. ‚úÖ **–°–µ—Ç–µ–≤–∞—è –ø–æ–ª–æ—Å–∞** –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### 1. `w:\app\frontend\src\components\Table\index.tsx`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

```typescript
import { useQueryClient } from "@tanstack/react-query";
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `TableBody`:**

```typescript
const TableBody = memo(() => {
	// ... –¥—Ä—É–≥–æ–π –∫–æ–¥ ...

	const queryClient = useQueryClient();

	const checkAndFetch = useCallback(() => {
		// ... –ø—Ä–æ–≤–µ—Ä–∫–∏ ...

		if (currentViewEnd >= loadedRowsCount - FETCH_BUFFER && hasNextPage) {
			const fetchNextPage = actions.fetchNextPage;
			if (fetchNextPage) {
				// üîë –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢: –û—Ç–º–µ–Ω—è–µ–º –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
				queryClient.cancelQueries();

				// –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
				fetchNextPage();
			}
		}
	}, [
		hasNextPage,
		isFetchingNextPage,
		actions,
		scrollRef,
		rows.length,
		queryClient,
	]);

	// ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
});
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã—Å—Ç—Ä–æ —Å–∫—Ä–æ–ª–ª–∏—Ç –≤–Ω–∏–∑**
   - ScrollTop: 100 ‚Üí 200 ‚Üí 300 ‚Üí 400 ‚Üí 500 (–±—ã—Å—Ç—Ä–æ)

2. **–ù–∞ –∫–∞–∂–¥—ã–π scroll event –¥–µ–±–∞—É–Ω—Å –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ 150ms**
   - –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–±–∞—É–Ω—Å–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `checkAndFetch()`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: currentViewEnd >= (loadedRowsCount - 50)?
   - –£—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚Üí –≤—ã–∑—ã–≤–∞–µ–º `queryClient.cancelQueries()`
   - –í—Å–µ –≤-–ª—ë—Ç –∑–∞–ø—Ä–æ—Å—ã React Query –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
   - –ó–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π `fetchNextPage()`

3. **–ü–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–∫—Ä–æ–ª–∏—Ç—å**
   - React Query –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å
   - –°—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —É–∂–µ –æ—Ç–º–µ–Ω–µ–Ω—ã –±–ª–∞–≥–æ–¥–∞—Ä—è `cancelQueries()`
   - –°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å

4. **–ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π –ø–æ—Ä—Ü–∏–µ–π —Å—Ç—Ä–æ–∫
   - `isFetchingNextPage` = false
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–µ–π —Å–∫—Ä–æ–ª–ª–∞

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ –∏ –ø–æ—Å–ª–µ

**–î–û (–ø—Ä–æ–±–ª–µ–º–∞):**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –±—ã—Å—Ç—Ä–æ –≤–Ω–∏–∑:
Network tab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
  ‚Üí GET /activityhistories?cursor=100  (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
  ‚Üí GET /activityhistories?cursor=200  (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
  ‚Üí GET /activityhistories?cursor=300  (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
  ‚Üí GET /activityhistories?cursor=400  (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)  ‚Üê —Ç–æ–ª—å–∫–æ —ç—Ç–æ—Ç –∞–∫—Ç—É–∞–ª–µ–Ω!

–†–µ–∑—É–ª—å—Ç–∞—Ç: 4 –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ 1, –¥–≤–µ –ø–µ—Ä–≤—ã–µ –ø–æ—Ä—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
```

**–ü–û–°–õ–ï (—Ä–µ—à–µ–Ω–æ):**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –±—ã—Å—Ç—Ä–æ –≤–Ω–∏–∑:
Network tab –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
  ‚ùå GET /activityhistories?cursor=100  (–û–¢–ú–ï–ù–ï–ù)
  ‚ùå GET /activityhistories?cursor=200  (–û–¢–ú–ï–ù–ï–ù)
  ‚ùå GET /activityhistories?cursor=300  (–û–¢–ú–ï–ù–ï–ù)
  ‚Üí GET /activityhistories?cursor=400  (–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø) ‚úÖ

–†–µ–∑—É–ª—å—Ç–∞—Ç: 1 –∑–∞–ø—Ä–æ—Å, –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –∏–¥–µ—Ç –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### –ü–æ—á–µ–º—É `queryClient.cancelQueries()` —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **React Query —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏** —á–µ—Ä–µ–∑ queryClient
2. **`cancelQueries()` –æ—Ç–º–µ–Ω—è–µ—Ç –í–°–ï –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã** (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞)
3. **–°—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã** –≤—ã–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π `fetchNextPage()`
4. **–°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å** –≤–º–µ—Å—Ç–æ –æ—á–µ—Ä–µ–¥–∏ —Å—Ç–∞—Ä—ã—Ö

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–≥–∞—Ä–∞–Ω—Ç–∏—é** —Ç–æ–≥–æ, —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:** –∫–∞–∂–¥—ã–π –¥–µ–±–∞—É–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π scroll event (150ms –∑–∞–¥–µ—Ä–∂–∫–∞)
- **–£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:** —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `currentViewEnd >= loadedRowsCount - 50`
- **–õ–æ–≥–∏–∫–∞ –∑–∞—â–∏—Ç—ã:** –ø—Ä–æ–≤–µ—Ä–∫–∞ `isFetchingNextPage` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- **AbortSignal:** —É–∂–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ö—É–∫ `useInfiniteModelList` —á–µ—Ä–µ–∑ `signal` –ø–∞—Ä–∞–º–µ—Ç—Ä `queryFn`

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                      | –î–æ                  | –ü–æ—Å–ª–µ     |
| ---------------------------- | ------------------- | --------- |
| –ó–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ | 5-10                | 1-2       |
| –°–µ—Ç–µ–≤–æ–π —Ç—Ä–∞—Ñ–∏–∫               | 500-1000KB          | 100-200KB |
| –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö        | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–æ—á–µ—Ä–µ–¥—å) | –ë—ã—Å—Ç—Ä–µ–µ   |
| –ó–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–∫–ª–∏–∫–∞ UI          | –í–∏–¥–Ω–∞               | –ù–µ–∑–∞–º–µ—Ç–Ω–∞ |

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ò–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞:**

   ```typescript
   queryClient.cancelQueries({
   	queryKey: [model, "infinite"],
   });
   ```

   (–≤–º–µ—Å—Ç–æ –æ—Ç–º–µ–Ω—ã –í–°–ï –∑–∞–ø—Ä–æ—Å–æ–≤)

2. **Throttle –≤–º–µ—Å—Ç–æ debounce:**

   ```typescript
   // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–¥–Ω–æ–π –≤ 100ms –≤–º–µ—Å—Ç–æ –¥–µ–±–∞—É–Ω—Å–∞ 150ms
   ```

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π FETCH_BUFFER:**
   ```typescript
   // –£–≤–µ–ª–∏—á–∏—Ç—å –±—É—Ñ–µ—Ä –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ç—è—Ö (2G/3G)
   const FETCH_BUFFER = isSlow5G ? 100 : 50;
   ```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `queryClient.cancelQueries()` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- ‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–∫—Ä–æ–ª–ª–µ
- ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ (80-90% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
- ‚úÖ –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ `checkAndFetch`)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Ç–º–µ–Ω–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è AbortSignal –≤ —Ö—É–∫–µ
