# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–æ–∫ (Infinite Scroll)

## –ü—Ä–æ–±–ª–µ–º–∞ ‚ùå

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ (–æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ `total`), –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –Ω–æ–≤—ã–µ –ø–æ—Ä—Ü–∏–∏ —Å—Ç—Ä–æ–∫.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**

- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –≤–Ω–∏–∑
- –°–∫—Ä–æ–ª–ª–±–∞—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–≤–∏–∂–µ—Ç—Å—è –ø–æ –≤—Å–µ–º—É –¥–∏–∞–ø–∞–∑–æ–Ω—É (0-5000 —Å—Ç—Ä–æ–∫)
- –ù–æ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —Å—Ç—Ä–æ–∫
- –ù–æ–≤—ã–µ –ø–æ—Ä—Ü–∏–∏ –Ω–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è

## –ü—Ä–∏—á–∏–Ω–∞ ü§î

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:

### 1. **–§–∏–ª—å—Ç—Ä –≤–∏–¥–∏–º—ã—Ö —Å—Ç—Ä–æ–∫** (–û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê)

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
// –°–∫—Ä–æ–ª–ª–∏–º –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 500px
// scrollTop = 500
// startIndexVirtual = 500 / 28 = 17

// –Ω–æ rows —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (indices 0-99)
const visibleRows = rows.filter((_row, idx) => {
	return idx >= startIndexVirtual && idx < endIndexVirtual;
	// 0-99 >= 17? –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º... –Ω–æ –∫–æ–≥–¥–∞ —Å–∫—Ä–æ–ª–ª–∏–º –¥–∞–ª—å—à–µ...
});
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
const visibleRows = useMemo(() => {
	// –ï—Å–ª–∏ —Å–∫—Ä–æ–ª–ª–∏–º –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞ —Å—Ç—Ä–æ–∫—É 250)
	// –Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–ª—å–∫–æ 100, —Ç–æ:
	if (startIndexVirtual >= rows.length) {
		return []; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ
	}

	// –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö, —á—Ç–æ –≤–∏–¥–Ω—ã
	const visibleStart = Math.max(0, startIndexVirtual); // 0
	const visibleEnd = Math.min(rows.length, endIndexVirtual); // min(100, 250) = 100

	return rows.slice(visibleStart, visibleEnd);
}, [rows, startIndexVirtual, endIndexVirtual]);
```

### 2. **–¢—Ä–∏–≥–≥–µ—Ä –ø–æ–¥–≥—Ä—É–∑–∫–∏** (–í–¢–û–†–ò–ß–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê)

**–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
const scrolledToBottom =
	el.scrollHeight - el.scrollTop <= el.clientHeight + 300;
// –° –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π scrollHeight != total * ROW_HEIGHT
// –ü–æ—ç—Ç–æ–º—É —ç—Ç–æ —É—Å–ª–æ–≤–∏–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç!
```

**–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```typescript
const currentViewEnd = Math.ceil((el.scrollTop + el.clientHeight) / ROW_HEIGHT);
const loadedRowsCount = rows.length;
const FETCH_BUFFER = 50; // —Ç—Ä–∏–≥–≥–µ—Ä –∑–∞ 50 —Å—Ç—Ä–æ–∫ –¥–æ –∫–æ–Ω—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö

// –ï—Å–ª–∏ –º—ã —Å–º–æ—Ç—Ä–∏–º –Ω–∞ –ø–æ–∑–∏—Ü–∏—é –±–ª–∏–∑–∫–æ –∫ –∫–æ–Ω—Ü—É –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö -> –ø–æ–¥–≥—Ä—É–∂–∞–µ–º
if (currentViewEnd >= loadedRowsCount - FETCH_BUFFER && hasNextPage) {
	fetchNextPage();
}
```

## –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã (–°–ï–ô–ß–ê–°) ‚úÖ

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∫—Ä–æ–ª–ª–∏—Ç –≤–Ω–∏–∑
         ‚Üì
scrollTop = 2800px (100-—è —Å—Ç—Ä–æ–∫–∞)
         ‚Üì
startIndexVirtual = floor(2800/28) - 8 = 92
endIndexVirtual = ceil((2800+600)/28) + 8 = 137
         ‚Üì
rows.length = 100 (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 100)
         ‚Üì
startIndexVirtual >= rows.length?
92 >= 100? –ù–ï–¢
         ‚Üì
visibleStart = max(0, 92) = 92
visibleEnd = min(100, 137) = 100
         ‚Üì
visibleRows = rows.slice(92, 100) = 8 —Å—Ç—Ä–æ–∫ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ)
         ‚Üì
currentViewEnd = ceil((2800+600)/28) = 121
loadedRowsCount = 100
currentViewEnd >= loadedRowsCount - 50?
121 >= 50? –î–ê!
         ‚Üì
fetchNextPage() ‚Üê –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –µ—â–µ 100 —Å—Ç—Ä–æ–∫!
         ‚Üì
rows.length = 200
         ‚Üì
–°–ª–µ–¥—É—é—â–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –µ—â–µ —Å—Ç—Ä–æ–∫–∏...
```

## –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```typescript
const ROW_HEIGHT = 28; // –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫–∏
const OVERSCAN = 8; // –ë—É—Ñ–µ—Ä —Å—Ç—Ä–æ–∫ (–≤–≤–µ—Ä—Ö—É/–≤–Ω–∏–∑—É)

// –í checkAndFetch:
const FETCH_BUFFER = 50; // –ü–æ–¥–≥—Ä—É–∂–∞—Ç—å –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–ª–æ—Å—å 50 —Å—Ç—Ä–æ–∫
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- **FETCH_BUFFER = 50** –æ–∑–Ω–∞—á–∞–µ—Ç:
  - –ó–∞–≥—Ä—É–∂–µ–Ω–æ 100 —Å—Ç—Ä–æ–∫
  - –ö–æ–≥–¥–∞ –≤–∏–¥–∏–º —Å—Ç—Ä–æ–∫—É > 50, –ø–æ–¥–≥—Ä—É–∂–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Ä—Ü–∏—é
  - –ö–æ–≥–¥–∞ –≤–∏–¥–∏–º —Å—Ç—Ä–æ–∫—É > 100, –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –µ—â–µ
  - –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –º–µ—Ä–µ —Å–∫—Ä–æ–ª–ª–∞

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console**
   - –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
   - –°–º–æ—Ç—Ä–∏—Ç–µ Network tab
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è XHR –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ ~50 —Å—Ç—Ä–æ–∫

2. **DevTools ‚Üí Elements**
   - –°–º–æ—Ç—Ä–∏—Ç–µ tbody
   - –í–∏–¥–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
   - Padding –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏

3. **–°–∫—Ä–æ–ª–ª–±–∞—Ä**
   - –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ —Å–∫—Ä–æ–ª–ª–±–∞—Ä –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å—Å—è
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! (total –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–æ –º–µ–Ω—å—à–µ —Å—Ç—Ä–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å)

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### Table/index.tsx

**checkAndFetch:**

```diff
- const scrolledToBottom = el.scrollHeight - el.scrollTop <= el.clientHeight + 300;
+ const currentViewEnd = Math.ceil((el.scrollTop + el.clientHeight) / ROW_HEIGHT);
+ const FETCH_BUFFER = 50;
+ if (currentViewEnd >= rows.length - FETCH_BUFFER && hasNextPage)
```

**visibleRows:**

```diff
- return rows.filter((_row, idx) => idx >= startIndexVirtual && idx < endIndexVirtual);
+ if (startIndexVirtual >= rows.length) return [];
+ const visibleStart = Math.max(0, startIndexVirtual);
+ const visibleEnd = Math.min(rows.length, endIndexVirtual);
+ return rows.slice(visibleStart, visibleEnd);
```

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –∏ –ø–æ–¥–≥—Ä—É–∑–∫—É –Ω–æ–≤—ã—Ö –ø–æ—Ä—Ü–∏–π! üéâ
